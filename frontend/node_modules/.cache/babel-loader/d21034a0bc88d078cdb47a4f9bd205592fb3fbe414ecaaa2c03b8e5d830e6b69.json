{"ast":null,"code":"import axios from 'axios';\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5001/api';\nconst api = axios.create({\n  baseURL: API_URL,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\n\n// Add a request interceptor to include the auth token and cancel unauthorized status updates\napi.interceptors.request.use(config => {\n  const token = localStorage.getItem('token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n\n  // Cancel status update requests for non-maintainers\n  const user = JSON.parse(localStorage.getItem('user') || '{}');\n  if (config.method && ['post', 'put', 'patch'].includes(config.method.toLowerCase())) {\n    if (config.url && config.url.match(/\\/reports\\/[^\\/]+\\/status$/)) {\n      if (user.role !== 'maintainer') {\n        // Cancel the request\n        return Promise.reject(new axios.Cancel('Access denied: Only maintainers can update status'));\n      }\n    }\n  }\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\n\n// Add a response interceptor to handle errors\napi.interceptors.response.use(response => {\n  return response;\n}, error => {\n  if (error.response && error.response.status === 401) {\n    // Only redirect to login if not already on login page\n    if (window.location.pathname !== '/login') {\n      localStorage.removeItem('token');\n      window.location.href = '/login';\n    }\n  }\n  // Ignore 403 errors for read-only users (field heads, students)\n  // These are expected when they try to access update endpoints\n  if (error.response && error.response.status === 403) {\n    console.warn('Access denied - this is expected for read-only users');\n    return Promise.reject(error);\n  }\n  return Promise.reject(error);\n});\nexport default api;","map":{"version":3,"names":["axios","API_URL","process","env","REACT_APP_API_URL","api","create","baseURL","headers","interceptors","request","use","config","token","localStorage","getItem","Authorization","user","JSON","parse","method","includes","toLowerCase","url","match","role","Promise","reject","Cancel","error","response","status","window","location","pathname","removeItem","href","console","warn"],"sources":["/Users/sunnykishan/Downloads/campus-issue-reporter/frontend/src/services/api.js"],"sourcesContent":["import axios from 'axios';\n\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5001/api';\n\nconst api = axios.create({\n  baseURL: API_URL,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\n\n// Add a request interceptor to include the auth token and cancel unauthorized status updates\napi.interceptors.request.use(\n  (config) => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n\n    // Cancel status update requests for non-maintainers\n    const user = JSON.parse(localStorage.getItem('user') || '{}');\n    if (config.method && ['post', 'put', 'patch'].includes(config.method.toLowerCase())) {\n      if (config.url && config.url.match(/\\/reports\\/[^\\/]+\\/status$/)) {\n        if (user.role !== 'maintainer') {\n          // Cancel the request\n          return Promise.reject(new axios.Cancel('Access denied: Only maintainers can update status'));\n        }\n      }\n    }\n\n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\n\n// Add a response interceptor to handle errors\napi.interceptors.response.use(\n  (response) => {\n    return response;\n  },\n  (error) => {\n    if (error.response && error.response.status === 401) {\n      // Only redirect to login if not already on login page\n      if (window.location.pathname !== '/login') {\n        localStorage.removeItem('token');\n        window.location.href = '/login';\n      }\n    }\n    // Ignore 403 errors for read-only users (field heads, students)\n    // These are expected when they try to access update endpoints\n    if (error.response && error.response.status === 403) {\n      console.warn('Access denied - this is expected for read-only users');\n      return Promise.reject(error);\n    }\n    return Promise.reject(error);\n  }\n);\n\nexport default api;"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AAEzB,MAAMC,OAAO,GAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,IAAI,2BAA2B;AAE5E,MAAMC,GAAG,GAAGL,KAAK,CAACM,MAAM,CAAC;EACvBC,OAAO,EAAEN,OAAO;EAChBO,OAAO,EAAE;IACP,cAAc,EAAE;EAClB;AACF,CAAC,CAAC;;AAEF;AACAH,GAAG,CAACI,YAAY,CAACC,OAAO,CAACC,GAAG,CACzBC,MAAM,IAAK;EACV,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EAC3C,IAAIF,KAAK,EAAE;IACTD,MAAM,CAACJ,OAAO,CAACQ,aAAa,GAAG,UAAUH,KAAK,EAAE;EAClD;;EAEA;EACA,MAAMI,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACL,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC;EAC7D,IAAIH,MAAM,CAACQ,MAAM,IAAI,CAAC,MAAM,EAAE,KAAK,EAAE,OAAO,CAAC,CAACC,QAAQ,CAACT,MAAM,CAACQ,MAAM,CAACE,WAAW,CAAC,CAAC,CAAC,EAAE;IACnF,IAAIV,MAAM,CAACW,GAAG,IAAIX,MAAM,CAACW,GAAG,CAACC,KAAK,CAAC,4BAA4B,CAAC,EAAE;MAChE,IAAIP,IAAI,CAACQ,IAAI,KAAK,YAAY,EAAE;QAC9B;QACA,OAAOC,OAAO,CAACC,MAAM,CAAC,IAAI3B,KAAK,CAAC4B,MAAM,CAAC,mDAAmD,CAAC,CAAC;MAC9F;IACF;EACF;EAEA,OAAOhB,MAAM;AACf,CAAC,EACAiB,KAAK,IAAK;EACT,OAAOH,OAAO,CAACC,MAAM,CAACE,KAAK,CAAC;AAC9B,CACF,CAAC;;AAED;AACAxB,GAAG,CAACI,YAAY,CAACqB,QAAQ,CAACnB,GAAG,CAC1BmB,QAAQ,IAAK;EACZ,OAAOA,QAAQ;AACjB,CAAC,EACAD,KAAK,IAAK;EACT,IAAIA,KAAK,CAACC,QAAQ,IAAID,KAAK,CAACC,QAAQ,CAACC,MAAM,KAAK,GAAG,EAAE;IACnD;IACA,IAAIC,MAAM,CAACC,QAAQ,CAACC,QAAQ,KAAK,QAAQ,EAAE;MACzCpB,YAAY,CAACqB,UAAU,CAAC,OAAO,CAAC;MAChCH,MAAM,CAACC,QAAQ,CAACG,IAAI,GAAG,QAAQ;IACjC;EACF;EACA;EACA;EACA,IAAIP,KAAK,CAACC,QAAQ,IAAID,KAAK,CAACC,QAAQ,CAACC,MAAM,KAAK,GAAG,EAAE;IACnDM,OAAO,CAACC,IAAI,CAAC,sDAAsD,CAAC;IACpE,OAAOZ,OAAO,CAACC,MAAM,CAACE,KAAK,CAAC;EAC9B;EACA,OAAOH,OAAO,CAACC,MAAM,CAACE,KAAK,CAAC;AAC9B,CACF,CAAC;AAED,eAAexB,GAAG","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}